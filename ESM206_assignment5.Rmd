---
title: "Trends in Graduate Enrollment, Shifting Fields of Study, and Faculty Salary"
author: "Sam Csik"
date: "11/28/2018"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load packages & data}

library(tidyverse)
library(reshape2)
library(effsize)
library(scales)
library(stargazer)

enrollment <- read_csv("grad_enrollment_copy.csv")
postdoc_salary <- read_csv("median_salary_copy.csv")
fields <- read_csv("phds_by_field_copy.csv")
fields_85 <- read_csv("phds_field_1985.csv")
fields_00 <- read_csv("phds_field_2000.csv")
fields_15 <- read_csv("phds_field_2015.csv")

```

###To Do:
1) figure out stats?? OR are absolute differences???
2) fig caption
```{r male vs. female grad enrollment (1967-2015)}

# SOURCE: U.S. Department of Education, National Center for Education Statistics, Higher Education General Information Survey (HEGIS), “Fall Enrollment in Colleges and Universities” surveys, 1967 through 1985; Integrated Postsecondary Education Data System (IPEDS),“Fall Enrollment Survey” (IPEDS-EF:86-99); IPEDS Spring 2001 through Spring 2016, Fall Enrollment component. Accessed at: https:// nces.ed.gov/ programs/digest/ d16/ tables/ dt16_303.80.asp.

##############################
# subset total males and females
##############################

total_males <- enrollment %>% 
  select(year, total_males) %>% 
  mutate(total = total_males) # add column called "total" that is equal to the "total_males" column so that we can plot males and females on same plot with same y-axis

total_females <- enrollment %>% 
  select(year, total_females) %>% 
  mutate(total = total_females) # add column called "total" that is equal to the "total_females" column so that we can plot males and females on same plot with same y-axis

##############################
# plot trends through time
##############################

total_enroll_plot <- ggplot(total_males, aes(x = year, y = total)) +
  geom_point(color = "gray30", alpha = 0.5) +
  geom_line(color = "black") +
  geom_point(data = total_females, color = "gray30", alpha = 0.5) +
  geom_line(data = total_females, color = "black", linetype = "dotted") +
  theme_classic() +
  theme(panel.border = element_rect(colour = "black", fill = NA, size = 0.7)) +
  labs(x = "Year", y = "Total Male & Female Graduate Student \nEnrollment in the U.S.") +
  scale_y_continuous(labels = scales::scientific)

# Figure 1. Male and female graduate student enrollment in the U.S. (1967-2015). Total postbaccalaureate fall enrollment at degree-granting postsecondary insitutions includes part- and full-time male (solid line) and female (dotted line) graduate students from both public and private institutions. Data from ___.

##############################
# net & percent increase in total males
##############################

m_1967 <- total_males %>% # subset 1967 males
  filter(year == 1967)

m_2015 <- total_males %>% # subset 2015 males
  filter(year == 2015)

net_males <- m_2015$total - m_1967$total # net increase from 1967-2015
fold_males <- m_2015$total/m_1967$total # fold increase from 1967-2015
perc_males <- ((m_2015$total - m_1967$total)/m_1967$total) * 100 # % increase from 1967 - 2015

##############################
# net & percent increase in total females
##############################

f_1967 <- total_females %>% # subset 1967 females
  filter(year == 1967)

f_2015 <- total_females %>% # subset 2015 females 
  filter(year == 2015)

net_females <- f_2015$total - f_1967$total # net increase from 1967-2015
fold_females <- f_2015$total/f_1967$total # fold increase from 1967-2015
perc_females <- ((f_2015$total - f_1967$total)/f_1967$total) * 100 # % increase from 1967 - 2015

##############################
# findings
##############################

# since 1967, there has been a dramatic rise in female graduate student enrollment in the U.S. as compared to males
  # male enrollment has nearly doubled (1.9 fold), whereas we observe a 6.5 fold increase in female enrollment
  # net increase in males was 59,0865; net increase in females was 1,453,562

```

####To Do:
1) Stats
2) fig caption
```{r shifts in female PhD recipients by field (1985, 2000, 2015)}

#SOURCE: National Science Foundation, National Center for Science and Engineering Statistics, Survey of Earned Doctorates. You can find more information here: https:// www.nsf.gov/ statistics/ srvydoctorates/ .

##############################
# subset out females by field from years 1985, 2000, 2015
##############################

female_phd <- fields %>% 
  filter(field == "phys_earth_female" | field == "engineering_female" | 
           field == "edu_female" | field == "humanities_arts_female") %>% 
  select(field, `1985_raw`, `2000_raw`, `2015_raw`) %>% 
  rename(`1985` = `1985_raw`, `2000` = `2000_raw`, `2015` = `2015_raw`) 

##############################
# find total females across all four fields for each year and subset out each year's total
##############################

female_phd_total <- female_phd %>% 
  summarise(
    total_1985 = sum(`1985`),
    total_2000 = sum(`2000`),
    total_2015 = sum(`2015`)
  )

tot_1985 <- female_phd_total$total_1985
tot_2000 <- female_phd_total$total_2000
tot_2015 <- female_phd_total$total_2015

##############################
# add column to female_phd df with calculated percentages
##############################

female_phd_perc <- female_phd %>% 
  mutate(perc_1985  = round((`1985`/tot_1985) * 100, 1), perc_2000 = round((`2000`/tot_2000) * 100, 1), perc_2015 = round((`2015`/tot_2015) * 100, 1)) %>% # calculate percentage of females within each of the four fields
  select(field, perc_1985, perc_2000, perc_2015) %>% 
  mutate(
    field_long = case_when( # do this so legend labels are correct
      field == "edu_female" ~ "Education",
      field == "humanities_arts_female" ~ "Humanities & Arts",
      field == "engineering_female" ~ "Engineering",
      field == "phys_earth_female" ~ "Physical & Earth Sciences"
    )
  )

##############################
# convert to long format
##############################

female_phd_long <- melt(female_phd_perc, variable.name = "year", value.name = "percent") %>% 
 mutate(
   year_long = case_when(
     year == "perc_1985" ~ "1985",
     year == "perc_2000" ~ "2000",
     year == "perc_2015" ~ "2015"
   )
 ) %>% 
  select(field_long, year_long, percent)

##############################
# create stacked barplot
##############################

female_phd_plot <- ggplot(female_phd_long, aes(x = year_long, y = percent, fill = field_long)) + 
  geom_bar(stat = "identity", colour = "black") +
  geom_text(aes(x = year_long, y = percent, label = paste0(percent,"%")), size = 4,
            position = position_stack(vjust = 0.5)) +
  theme_classic() +
  theme(panel.border = element_rect(colour = "black", fill = NA, size = 0.7)) +
  scale_y_continuous(expand = c(0,0), limits = c(0,110)) +
  labs(x = "Year", y = "Female PhD Recipients by Field (%)") +
  scale_fill_manual(name = "Field of Study", values = c("snow4", "snow", "thistle4", "slategray2"))

# Figure 2: Percentage of female PhD recipients by field from 1985, 2000, & 2015. Percentages of female PhD recipients from 1985 (n = 5,650), 2000 (n = 8,711), and 2015 (n = 10,623) were assessed across 4 focal fields of study: Education, Engineering, Humanities & Arts, Physical & Earth Sciences. Fields assessed include education, Other academic fields have not been considered for this plot.... THIS STILL ISN'T RIGHT...
```


####To Do:
1) stats (mainly initial exploratory shit that I can't get to work)
2) fig caption
```{r male & female salaries for starting postdoc and other employment positions (2015)}

# SOURCE: National Science Foundation, National Center for Science and Engineering Statistics, Survey of Earned Doctorates, 2015.

##############################
# make data into long format
##############################

postdoc_salary_long <- melt(postdoc_salary, variable.name = "employment_status", value.name = "salary") 

##############################
# add column with "sex"
##############################

postdoc_salary_new <- postdoc_salary_long %>%
  mutate(
    sex = case_when(
      employment_status == "employment_males" ~ "Male",
      employment_status == "postdoc_study_males" ~ "Male",
      employment_status == "employment_females" ~ "Female",
      employment_status == "postdoc_study_females" ~ "Female"
    )
  ) %>% 
  mutate(
    status = case_when(
      employment_status == "employment_males" ~ "Employed",
      employment_status == "postdoc_study_males" ~ "Postdoc-study",
      employment_status == "employment_females" ~ "Employed",
      employment_status == "postdoc_study_females" ~ "Postdoc-study"
    )
  )

##############################
# make status a factor, and list levels in the desired facet order
##############################

postdoc_salary_new$status<- factor(postdoc_salary_new$status, levels=c("Postdoc-study", "Employed"))

##############################
# boxplot of employment males vs. females & postdoc males vs. females
##############################

postdoc_salary_plot <- ggplot(postdoc_salary_new, aes(x = sex, y = salary)) +
  geom_boxplot(aes(group = sex, fill = factor(sex))) +
  scale_fill_manual(values = c("white", "darkgrey"), name = "Sex") +
  facet_grid(~ status) +
  labs(x = "", y = "Salary (USD)") +
  scale_y_continuous(label = dollar_format()) +
  theme_classic() +
  theme(
    axis.text.x = element_blank(),
    axis.ticks.x=element_blank(),
    panel.border = element_rect(colour = "black", fill=NA, size=0.7))

##############################
# separately subset males & females by employed & postdoc status
##############################

male_postdoc <- postdoc_salary_new %>% 
  filter(sex == "Male", status == "Postdoc-study")

female_postdoc <- postdoc_salary_new %>% 
  filter(sex == "Female", status == "Postdoc-study")

male_employed <- postdoc_salary_new %>% 
  filter(sex == "Male", status == "Employed")

female_employed <- postdoc_salary_new %>% 
  filter(sex == "Female", status == "Employed")

##############################
# EXPLORATORY PLOTS & ASSUMPTIONS NONE OF THIS IS FUCKING WORKING I FEEL DUMB
##############################

employment_status_hist <- ggplot(postdoc_salary_new, aes(x = "salary")) + 
  geom_histogram()

employment_summary_stats <- postdoc_salary_new %>% 
  group_by(status, sex) %>% 
  summarize(
    mean = mean(salary),
    var = var(salary) # VARIANCE IS WAYY OFF???
  )

##############################
# 1-way 2-sample t-tests
##############################

postdoc_t <- t.test(male_postdoc$salary, female_postdoc$salary, alternative = "greater") # p = 0.45
employed_t <- t.test(male_employed$salary, female_employed$salary, alternative = "greater") # p = 0.24

# median salary does not differ significantly between males and females starting postdoc positions 
# median salary does not differ significantly between male and female PhD recipients in non-postdoc employment positions

##############################
# effect size
##############################

postdoc_d <- cohen.d(male_postdoc$salary, female_postdoc$salary) # negligible
abs_postdoc <- median(male_postdoc$salary) - median(female_postdoc$salary) # males > females by $3000
perc_postdoc <- (median(male_postdoc$salary) - median(female_postdoc$salary))/(median(female_postdoc$salary)) * 100 # male postdoc salary 6.7% higher than females

employed_d <- cohen.d(male_employed$salary, female_employed$salary) # small
abs_employed <- median(male_employed$salary) - median(female_employed$salary) # males > females by $3417
perc_employed <- (median(male_employed$salary) - median(female_employed$salary))/(median(female_employed$salary)) * 100  # male employed salary 4.8% higher than females
```


```{r exploring academic salaries for profs in US colleges}


##### Shifts in female PhD recipients by field (1985, 2000, and 2015). 
#Describe if and how there was a shift in PhDs awarded to females in four fields (Physical and Earth Sciences, Engineering, Education, and Humanities & Arts) in 1985, 2000, and 2015. Describe your results statistically, in a graph or table, and in text. Note: There are several ways that you can interpret this question. You are invited to decide which you think is/are most interesting. Just be really clear about what you are asking/answering in your report.

```

```{r chi square}
#### chi square for 1985 ####
fields_85_simpl <- fields_85 %>% 
  select(-sex)

rownames(fields_85_simpl) <- c("male", "female")

fields_85_prop <- prop.table(as.matrix(fields_85_simpl), 1)

fields85_chi <- chisq.test(fields_85_simpl)
fields85_chi
# proportions are different, no shit

#### chi square for 2000 ####

fields_00_simpl <- fields_00 %>% 
  select(-sex)

rownames(fields_00_simpl) <- c("male", "female")

fields_00_prop <- prop.table(as.matrix(fields_00_simpl), 1)

fields00_chi <- chisq.test(fields_00_simpl)
fields00_chi
# proportions are different

#### chi square for 2015 ####

fields_15_simpl <- fields_15 %>% 
  select(-sex)

rownames(fields_15_simpl) <- c("male", "female")

fields_15_prop <- prop.table(as.matrix(fields_15_simpl), 1)

fields15_chi <- chisq.test(fields_15_simpl)
fields15_chi
# proportions are different

```

##### Model describing faculty salary
Explore relationships between
variables in the ‘Faculty salary data (2008 - 2009 survey)’ dataset. Develop a model describing faculty
salary based on data for faculty sex, rank, years in current position, field, and number of years since
doctoral degree was earned. You should make decisions regarding which variables should remain in your
final model. Describe the results qualitatively and quantitatively (i.e., don’t just report the statistical
results of the model – make sure you describe interesting findings in text). You can also discuss any
concerns that you have with the model(s) you present, if any.

```{r all variables}
#### all variables ####
facsal_lm1 <- lm(salary ~ rank + discipline + years_since + years_service + sex, data = faculty_salary)
summary(facsal_lm1)
plot(facsal_lm1)

```

```{r rank-discipline-sex-years_since}
facsal_lm2 <- lm(salary ~ rank + discipline + sex + years_since, data = faculty_salary)
summary(facsal_lm2)
plot(facsal_lm2)
```

```{r rank-discipline-sex-years_service}
facsal_lm3 <- lm(salary ~ rank + discipline + sex + years_service, data = faculty_salary)
summary(facsal_lm3)
plot(facsal_lm3)
# doesn't look good
```

```{r rank-discipline-sex}
facsal_lm4 <- lm(salary ~ rank + discipline + sex, data = faculty_salary)
summary(facsal_lm4)
# closest adjusted r-squared to model that includes all variables
plot(facsal_lm4)
# this is probably the best one
```

```{r rank-discipline-years_since}
facsal_lm5 <- lm(salary ~ rank + discipline + years_since, data = faculty_salary)
summary(facsal_lm5)
```

```{r AIC values}
AIC_lm1 <- AIC(facsal_lm1)
AIC_lm1
# 9093.826

AIC_lm2 <- AIC(facsal_lm2)
AIC_lm2
# 9097.22

AIC_lm3 <- AIC(facsal_lm3)
AIC_lm3
# 9096.813

AIC_lm4 <- AIC(facsal_lm4)
AIC_lm4
# 9095.454

AIC_lm5 <- AIC(facsal_lm5)
AIC_lm5
# 9096.497
```


###References:

(Figure 1) U.S. Department of Education, National Center for Education Statistics, Higher Education General Information Survey (HEGIS), "Fall Enrollment in Colleges and Universities" surveys, 1967 through 1985; Integrated Postsecondary Education Data System (IPEDS), "Fall Enrollment Survey" (IPEDS-EF:86-99); IPEDS Spring 2001 through Spring 2016, Fall Enrollment component; and Enrollment in Degree-Granting Institutions Projection Model, 2000 through 2026. Accessed at: https:// nces.ed.gov/ programs/digest/ d16/ tables/ dt16_303.80.asp.

(Figure 2) National Science Foundation, National Center for Science and Engineering Statistics, Survey of Earned Doctorates. https:// www.nsf.gov/ statistics/ srvydoctorates/ .

(Figure 3) National Science Foundation, National Center for Science and Engineering Statistics, Survey of Earned Doctorates, 2015.


